
<Lems>

<!-- Example of conductance based cell with Na, K (incl [Ca2+] dependent) & Ca channels and a pool of Ca -->


<!-- Specify which component to run -->
    <DefaultRun component="sim1"/>

<!-- Include core NeuroML2 ComponentType definitions -->
    <Include file="NeuroML2CoreTypes/Cells.xml"/>
    <Include file="NeuroML2CoreTypes/Networks.xml"/>
    <Include file="NeuroML2CoreTypes/Simulation.xml"/>


<!-- Main NeuroML2 content -->

    <ionChannel id="Pas" conductance="10pS" type="ionChannelPassive"/>




    <ionChannel id="CaLVA" conductance="10pS" type="ionChannelHH" species="ca">
        <notes>A High Voltage Activated Ca2+ channel</notes>
        <gateHH id="m" instances="2">
            <q10Settings type="q10ExpTemp" q10Factor="3" experimentalTemp="32 degC" celsius="37 degC"/>

            <timeCourse type="CaLVA_m_tau"/>
            <steadyState type="HHSigmoidVariable" rate="1" scale="6.2 mV" midpoint="-56 mV"/>
            
        </gateHH>
        <gateHH id="h" instances="1">
            <q10Settings type="q10ExpTemp" q10Factor="3" experimentalTemp="32 degC" celsius="37 degC"/>

            <timeCourse type="CaLVA_h_tau"/>
            <steadyState type="HHSigmoidVariable" rate="1" scale="-4 mV" midpoint="-80 mV"/>

        </gateHH>
    </ionChannel>


    <ComponentType name="CaLVA_m_tau" extends="baseVoltageDepTime">
        <Constant name="TIME_SCALE" dimension="time" value="1 ms"/>
        <Constant name="VOLT_SCALE" dimension="voltage" value="1 mV"/>
        <Behavior>
            <DerivedVariable name="V" dimension="none" value="v / VOLT_SCALE"/>
            <DerivedVariable name="t" exposure="t" dimension="time" value="(0.333 / (exp((V + 131) / (-16.7)) + exp((V + 15.8) / 18.2)) + 0.204) * TIME_SCALE"/>
        </Behavior>
    </ComponentType>


    <ComponentType name="CaLVA_h_tau" extends="baseVoltageDepTime">
        <Constant name="TIME_SCALE" dimension="time" value="1 ms"/>
        <Constant name="VOLT_SCALE" dimension="voltage" value="1 mV"/>
        <Behavior>
            <DerivedVariable name="V" dimension="none" value="v / VOLT_SCALE"/>
            <DerivedVariable name="t" exposure="t" dimension="time" value="(0.333 * exp((V + 466) / 66)) * TIME_SCALE" valueCondition="V  .lt. ( -81 )" valueIfFalse="(0.333 * exp((V + 21) / (-10.5)) + 9.32) * TIME_SCALE"/>
        </Behavior>
    </ComponentType>


    <concentrationModel id="concMod1" type="decayingPoolConcentrationModel"
                                         restingConc="7.55E-11 mol_per_cm3"
                                         decayConstant="10.0 ms"
                                         shellThickness="8.4E-6 cm"/>


    <cell id="SomaGHK">


        <morphology id="morphology_SomaGHK">

            <segment id="0" name="Soma">
                <proximal x="0.0" y="0.0" z="0.0" diameter="14.398"/>
                <distal x="32.3955" y="0.0" z="0.0" diameter="14.398"/>
            </segment>

            <segmentGroup id="Soma">
                <member segment="0"/>
            </segmentGroup>

            <segmentGroup id="all">
                <include segmentGroup="Soma"/>
            </segmentGroup>

            <segmentGroup id="soma_group">
                <include segmentGroup="Soma"/>
            </segmentGroup>

            
        </morphology>

            <!--Adding the biophysical parameters-->

        <biophysicalProperties id="biophys">

            <membraneProperties>


                <channelDensity condDensity="3.32484e-05 S_per_cm2" id="Pas_all" ionChannel="Pas" erev="-66.0 mV" ion="non_specific"/>

                <channelDensityGHK condDensity="0.1 mS_per_cm2" id="CaLVA_all" ionChannel="CaLVA"  ion="ca"/>


                <spikeThresh value="0 mV"/>

                <specificCapacitance value="1.57 uF_per_cm2"/>

                <initMembPotential value="-66.0 mV"/>

            </membraneProperties>

            <intracellularProperties>

                <species id="ca"
                         ion="ca"
                         concentrationModel="concMod1"
                         initialConcentration="50e-6 mM"
                         initialExtConcentration="2 mM"/>

                <resistivity value="0.1 kohm_cm"/>

            </intracellularProperties>

        </biophysicalProperties>

    </cell>


    <pulseGenerator id="pulseGen1" delay="100ms" duration="100ms" amplitude="-0.01 nA" />
    <pulseGenerator id="pulseGen2" delay="500ms" duration="100ms" amplitude="0.01 nA" />

    <voltageClamp id="vClamp1" delay="150ms" duration="50ms" targetVoltage="10mV" seriesResistance="1ohm"/>

    <network id="net1">
        <population id="hhpop" component="SomaGHK" size="1"/>
        <explicitInput target="hhpop[0]" input="pulseGen1"/>
        <explicitInput target="hhpop[0]" input="pulseGen2"/>
    </network>


        <!-- End of NeuroML2 content -->


    <Simulation id="sim1" length="800ms" step="0.01ms" target="net1">

        <Display id="d1" title="GHK Test: Voltage (mV)" timeScale="1ms">
            <Line id="l1" quantity="hhpop[0]/v" scale="1mV"  color="#ffffff" save="NML2_LEMS_v.dat"/>
            <Line id="l5" quantity="hhpop[0]/biophys/membraneProperties/CaLVA_all/erev" scale="1uA_per_cm2"  color="#00ff00" save="NML2_LEMS_cae.dat"/>
        </Display>

        <Display id="d2" title="GHK Test: rate variables" timeScale="1ms">

        
            <Line id="l5" quantity="hhpop[0]/biophys/membraneProperties/CaLVA_all/CaLVA/m/q" scale="1"  color="#770fff" save="NML2_LEMS_ca_m.dat"/>
            <Line id="l6" quantity="hhpop[0]/biophys/membraneProperties/CaLVA_all/CaLVA/h/q" scale="1"  color="#55f00f" save="NML2_LEMS_ca_h.dat"/>

        </Display>

        <Display id="d3" title="GHK Test: current densities (uA_per_cm2)" timeScale="1ms">
            <Line id="l5" quantity="hhpop[0]/biophys/membraneProperties/CaLVA_all/iDensity" scale="1uA_per_cm2"  color="#00ff00" save="NML2_LEMS_cai.dat"/>
        </Display>
<!--
        <Display id="d3" title="GHK Test: Ca concentration (mM)" timeScale="1ms">
            <Line id="li12" quantity="hhpop[0]/caConc" scale="1 mM"  color="#ffffff" save="NML2_LEMS_c2.dat"/>
        </Display>-->

        <Display id="d4" title="GHK Test: current totals" timeScale="1ms">
            <Line id="l0" quantity="hhpop[0]/pulseGen1/i" scale="1nA"  color="#dddddd" save="NML2_LEMS_naigc1.dat"/>
            <Line id="l1" quantity="hhpop[0]/pulseGen2/i" scale="1nA"  color="#dd3333" save="NML2_LEMS_naigc2.dat"/>
            <Line id="l2" quantity="hhpop[0]/iCa" scale="1nA"  color="#00aa00" save="NML2_LEMS_naic2.dat"/>
        </Display>
<!--
        <Display id="d5" title="GHK Test: taus" timeScale="1ms">
            <Line id="l01" quantity="hhpop[0]/biophys/membraneProperties/CaLVA_all/CaLVA/m/tau" scale="1ms"  color="#ddd222" save="NML2_LEMS_mtau.dat"/>
            <Line id="l02" quantity="hhpop[0]/biophys/membraneProperties/CaLVA_all/CaLVA/h/tau" scale="1ms"  color="#555222" save="NML2_LEMS_htau.dat"/>
        </Display>-->


    </Simulation>


</Lems>
